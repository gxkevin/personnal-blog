(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{368:function(t,e,v){"use strict";v.r(e);var _=v(42),a=Object(_.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"同源策略"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),v("p",[t._v("在了解跨域之前，我们先来看看"),v("code",[t._v("同源策略")]),t._v("这个知识")]),t._v(" "),v("h3",{attrs:{id:"一个源的定义"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一个源的定义"}},[t._v("#")]),t._v(" 一个源的定义")]),t._v(" "),v("p",[t._v("如果两个页面的"),v("code",[t._v("协议")]),t._v("，"),v("code",[t._v("端口")]),t._v("和"),v("code",[t._v("域名")]),t._v("都相同，那么这两个页面就具有相同的源。 举个例子：")]),t._v(" "),v("p",[t._v("下面的表相对http://www.bb.com 进行"),v("code",[t._v("同源检测")]),t._v("。")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"left"}},[t._v("url")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("结果")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("原因")])])]),t._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("http://www.bb.com/a.html")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("成功")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("http://www.bb.com/a/c/d.html")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("成功")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("https://www.bb.com/a/c/d.html")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("失败")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("不同协议("),v("code",[t._v("https")]),t._v("和"),v("code",[t._v("http")]),t._v(")")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("http://www.bb.com:520/a/c/d.html")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("失败")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("不同端口("),v("code",[t._v("80")]),t._v("和"),v("code",[t._v("520")]),t._v(")")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("http://www.cc.com/a/c/d.html")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("失败")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("不同域名("),v("code",[t._v("bb")]),t._v("和"),v("code",[t._v("cc")]),t._v(")")])])])]),t._v(" "),v("h3",{attrs:{id:"为什么要有这个策略？"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#为什么要有这个策略？"}},[t._v("#")]),t._v(" 为什么要有这个策略？")]),t._v(" "),v("p",[t._v("这个策略是一个浏览器的"),v("code",[t._v("安全功能")]),t._v("。不同源不能够互相读写对方资源。 为了保护用户的信息安全，隔离潜在的恶意文件。所以有了这个策略。 你想想，如果别人的网站可以请求到你的网站的用户数据，是不是挺可怕的。一个莫名其妙的网站就可以随意请求别人的数据。这对于互联网来说，简直就是一场灾难。")]),t._v(" "),v("h2",{attrs:{id:"跨域"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),v("p",[t._v("好的我们大概了解了浏览器的同源策略，知道这个策略是为了保护我们的互联网世界。")]),t._v(" "),v("p",[t._v("刚开始的时候，因为浏览器有这个同源策略，所以人们为了跨域获取资源，得用一些比较非常规的办法。")]),t._v(" "),v("h3",{attrs:{id:"jsonp（投机取巧）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#jsonp（投机取巧）"}},[t._v("#")]),t._v(" JSONP（投机取巧）")]),t._v(" "),v("p",[v("code",[t._v("HTML")]),t._v("中 "),v("code",[t._v("script")]),t._v(" 标签可以加载其他域下的"),v("code",[t._v("js")]),t._v("，比如我们经常引入其他域下线上"),v("code",[t._v("cdn")]),t._v("的"),v("code",[t._v("jQuery")]),t._v("。 人们就想利用这个特性来实现从其他域下获取数据。")]),t._v(" "),v("p",[t._v("我们比如说要获取另外一个网站的数据。")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('<script src="api.bb.com/data..."><\/script>\n复制代码\n')])])]),v("p",[t._v("这时候会向"),v("code",[t._v("data")]),t._v("接口发送请求获取数据，获取数据后作为"),v("code",[t._v("js")]),t._v("来执行，那么获取到的数据是"),v("code",[t._v("JSON")]),t._v("，直接作为"),v("code",[t._v("JS")]),t._v("运行我怎么拿到里面的"),v("code",[t._v("数据")]),t._v("呢？")]),t._v(" "),v("p",[t._v("这样我们就需要"),v("code",[t._v("后端")]),t._v("进行配合了。")]),t._v(" "),v("p",[t._v("之前后端返回的数据:")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('{"name:"bibi","city":"hangzhou"}\n')])])]),v("p",[t._v("现在后端返回的数据:")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('showData({"name:"bibi","city":"hangzhou"})\n')])])]),v("p",[t._v("这样前端在"),v("code",[t._v("script")]),t._v("标签加载数据后，将这个数据作为"),v("code",[t._v("js")]),t._v("来执行，实际上就相当于调用了"),v("code",[t._v("showData")]),t._v("这个函数。")]),t._v(" "),v("p",[t._v("我们只需要提前在页面定义好"),v("code",[t._v("showData")]),t._v("这个"),v("code",[t._v("全局函数")]),t._v("，在函数内部处理"),v("code",[t._v("参数")]),t._v("即可。")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('<script>\nfunction showData(ret){\nconsole.log(ret);\n}\n<script src="api.bb.com/data..."><\/script>\n复制代码\n')])])]),v("h4",{attrs:{id:"优点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[t._v("#")]),t._v(" 优点")]),t._v(" "),v("ul",[v("li",[t._v("兼容IE")])]),t._v(" "),v("h4",{attrs:{id:"缺点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),v("ul",[v("li",[t._v("需要前后端"),v("code",[t._v("配合")])]),t._v(" "),v("li",[t._v("只支持"),v("code",[t._v("GET")])])]),t._v(" "),v("p",[t._v("这就是通过JSONP跨域。")]),t._v(" "),v("p",[t._v('人们一直使用这种办法：直到W3C出了一个标准－CORS－"'),v("code",[t._v("跨域资源共享")]),t._v('"（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出'),v("code",[t._v("XMLHttpRequest")]),t._v("请求，从而克服了"),v("code",[t._v("AJAX只能同源使用的限制")]),t._v("。")]),t._v(" "),v("h3",{attrs:{id:"cors跨域"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cors跨域"}},[t._v("#")]),t._v(" CORS跨域")]),t._v(" "),v("p",[t._v("跨域资源共享（ CORS ）机制允许 Web 应用服务器进行跨域访问控制，从而使跨域数据传输得以安全进行。")]),t._v(" "),v("p",[t._v("CORS通信与同源的AJAX通信"),v("code",[t._v("没有差别")]),t._v("，代码完全一样。")]),t._v(" "),v("p",[t._v("我们只需要在响应头里加上 "),v("code",[t._v("xx.com")]),t._v(" 可以访问就可以了。")]),t._v(" "),v("p",[t._v("实现CORS通信的"),v("code",[t._v("关键")]),t._v("是服务器。只要"),v("code",[t._v("服务器")]),t._v("实现了CORS接口，就可以"),v("code",[t._v("跨源通信")]),t._v("。")]),t._v(" "),v("h4",{attrs:{id:"cors的两种请求"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cors的两种请求"}},[t._v("#")]),t._v(" cors的两种请求")]),t._v(" "),v("p",[t._v("浏览器将CORS请求分成两类："),v("code",[t._v("简单请求（simple request）和非简单请求（not-so-simple request）")]),t._v("。")]),t._v(" "),v("h5",{attrs:{id:"简单请求（simple-request）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#简单请求（simple-request）"}},[t._v("#")]),t._v(" 简单请求（simple request）")]),t._v(" "),v("p",[t._v("只要同时满足以下两大条件，就属于简单请求。")]),t._v(" "),v("blockquote",[v("p",[t._v("请求方法是以下三种方法之一：")])]),t._v(" "),v("ul",[v("li",[v("code",[t._v("HEAD")])]),t._v(" "),v("li",[v("code",[t._v("GET")])]),t._v(" "),v("li",[v("code",[t._v("POST")])])]),t._v(" "),v("blockquote",[v("p",[t._v("HTTP的头信息不超出以下几种字段：")])]),t._v(" "),v("ul",[v("li",[v("code",[t._v("Accept")])]),t._v(" "),v("li",[v("code",[t._v("Accept-Language")])]),t._v(" "),v("li",[v("code",[t._v("Content-Language")])]),t._v(" "),v("li",[v("code",[t._v("Last-Event-ID")])]),t._v(" "),v("li",[t._v("Content-Type：只限于三个值"),v("code",[t._v("application/x-www-form-urlencoded")]),t._v("、"),v("code",[t._v("multipart/form-data")]),t._v("、"),v("code",[t._v("text/plain")])])]),t._v(" "),v("p",[t._v("简单请求，就是在头信息中，增加一个"),v("code",[t._v("Origin字段")]),t._v("。 比如下面是一个跨域的"),v("code",[t._v("AJAX")]),t._v("请求，自动在头信息中，添加了一个"),v("code",[t._v("Origin")]),t._v("字段。")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("GET /cors HTTP/1.1\nOrigin: http://api.bb.com\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n复制代码\n")])])]),v("p",[v("code",[t._v("Origin")]),t._v("用来告诉服务器，本次请求来自哪个源（"),v("code",[t._v("协议")]),t._v(" + "),v("code",[t._v("域名")]),t._v(" + "),v("code",[t._v("端口")]),t._v("）。服务器根据这个值，决定是否同意这次请求。")]),t._v(" "),v("p",[t._v("如果服务器并不接受这个源，浏览器发现回应的信息头中没有"),v("code",[t._v("Access-Control-Allow-Origin")]),t._v(",就知道这是无效请求，并且抛出错误。")]),t._v(" "),v("p",[t._v("注意：种错误无法通过状态码识别，因为"),v("code",[t._v("HTTP")]),t._v("回应的状态码有可能是"),v("code",[t._v("200")]),t._v("。")]),t._v(" "),v("p",[t._v("如果这次请求被同意了，服务器就会返回下面的响应。")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("Access-Control-Allow-Origin: http://api.bob.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Expose-Headers: FooBar\nContent-Type: text/html; charset=utf-8\n复制代码\n")])])]),v("p",[t._v("上面的头信息中，三个都以"),v("code",[t._v("Access-Control-")]),t._v("开头。")]),t._v(" "),v("ul",[v("li",[v("code",[t._v("Access-Control-Allow-Origin")]),t._v("：该字段是必须的。它的值要么是请求时"),v("code",[t._v("Origin")]),t._v("字段的值，要么是一个`*``，表示接受任意域名的请求。")]),t._v(" "),v("li",[v("code",[t._v("Access-Control-Allow-Credentials")]),t._v(":该字段可选。它的值是一个布尔值，表示是否允许发送"),v("code",[t._v("Cookie")]),t._v("。默认情况下，"),v("code",[t._v("Cookie")]),t._v("不包括在"),v("code",[t._v("CORS")]),t._v("请求之中。设为"),v("code",[t._v("true")]),t._v("，即表示服务器明确许可，"),v("code",[t._v("Cookie")]),t._v("可以包含在请求中，一起发给服务器。这个值也只能设为"),v("code",[t._v("true")]),t._v("，如果服务器不要浏览器发送"),v("code",[t._v("Cookie")]),t._v("，删除该字段即可。")]),t._v(" "),v("li",[v("code",[t._v("Access-Control-Expose-Headers")]),t._v(":该字段可选。"),v("code",[t._v("CORS")]),t._v("请求时，"),v("code",[t._v("XMLHttpRequest")]),t._v("对象的"),v("code",[t._v("getResponseHeader()")]),t._v("方法只能拿到6个基本字段："),v("code",[t._v("Cache-Control")]),t._v("、"),v("code",[t._v("Content-Language")]),t._v("、"),v("code",[t._v("Content-Type")]),t._v("、"),v("code",[t._v("Expires")]),t._v("、"),v("code",[t._v("Last-Modified、Pragma")]),t._v("。如果想拿到其他字段，就必须在"),v("code",[t._v("Access-Control-Expose-Headers")]),t._v("里面指定。上面的例子指定，"),v("code",[t._v("getResponseHeader('FooBar')")]),t._v("可以返回"),v("code",[t._v("FooBar")]),t._v("字段的值。")])]),t._v(" "),v("h5",{attrs:{id:"非简单请求（复杂请求）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#非简单请求（复杂请求）"}},[t._v("#")]),t._v(" 非简单请求（复杂请求）")]),t._v(" "),v("p",[t._v("非简单请求是那种对服务器有特殊要求的请求，比如请求方法是"),v("code",[t._v("PUT")]),t._v("或"),v("code",[t._v("DELETE")]),t._v("，或者"),v("code",[t._v("Content-Type")]),t._v("字段的类型是"),v("code",[t._v("application/json")]),t._v("。")]),t._v(" "),v("p",[t._v("非简单请求的"),v("code",[t._v("CORS")]),t._v("请求，会在正式通信之前，增加一次"),v("code",[t._v("HTTP")]),t._v('查询请求，称为"预检"请求（preflight）。')]),t._v(" "),v("p",[t._v("浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些"),v("code",[t._v("HTTP动词")]),t._v("和"),v("code",[t._v("头信息字段")]),t._v("。只有得到肯定答复，浏览器才会发出正式的"),v("code",[t._v("XMLHttpRequest")]),t._v("请求，否则就报错。")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("var url = 'http://api.bibi.com/cors';\nvar xhr = new XMLHttpRequest();\nxhr.open('PUT', url, true);\nxhr.setRequestHeader('X-Custom-Header', 'value');\nxhr.send();\n复制代码\n")])])]),v("p",[t._v("这个请求就是一个复杂请求，当浏览器发现这是复杂请求后，就会向服务器发送预检请求，询问服务器是否允许本次请求。")]),t._v(" "),v("p",[t._v('服务器收到"预检"请求以后，检查了'),v("code",[t._v("Origin、Access-Control-Request-Method")]),t._v("和"),v("code",[t._v("Access-Control-Request-Headers")]),t._v("字段以后，确认允许跨源请求，就可以做出回应。")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("HTTP/1.1 200 OK\nDate: Mon, 01 Dec 2008 01:15:39 GMT\nServer: Apache/2.0.61 (Unix)\nAccess-Control-Allow-Origin: http://api.bibi.com\nAccess-Control-Allow-Methods: GET, POST, PUT\nAccess-Control-Allow-Headers: X-Custom-Header\nContent-Type: text/html; charset=utf-8\nContent-Encoding: gzip\nContent-Length: 0\nKeep-Alive: timeout=2, max=100\nConnection: Keep-Alive\nContent-Type: text/plain\n复制代码\n")])])]),v("p",[t._v("面的"),v("code",[t._v("HTTP")]),t._v("回应中，关键的是"),v("code",[t._v("Access-Control-Allow-Origin")]),t._v("字段，表示"),v("code",[t._v("http://api.bibi.com")]),t._v("可以请求数据。该字段也可以设为星号，表示同意任意跨源请求。")]),t._v(" "),v("p",[t._v("如果服务器拒绝预检请求，控制台就会报错。")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("XMLHttpRequest cannot load http://api.cc.com.\nOrigin http://api.bibi.com is not allowed by Access-Control-Allow-Origin.\n复制代码\n")])])]),v("p",[t._v("CORS缺点：不支持IE8/9，如果要在IE8/9使用"),v("code",[t._v("CORS")]),t._v("跨域需要使用"),v("code",[t._v("XDomainRequest")]),t._v("对象来支持"),v("code",[t._v("CORS")]),t._v("。")])])}),[],!1,null,null,null);e.default=a.exports}}]);